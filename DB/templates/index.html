<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Campus Corner Todo List</title>
  </head>
  <body>
    <h1>Todo List</h1>

    <!-- Form to add a new task -->
    <form id="task-form">
      <input type="number" id="userid" placeholder="User ID" required />
      <input type="text" id="task" placeholder="Enter task" required />
      <input type="date" id="duedate" />
      <input type="text" id="priority" placeholder="Priority" />
      <input type="text" id="category" placeholder="Category" />
      <button type="submit">Add Task</button>
    </form>

    <h2>All Tasks</h2>
    <ul id="tasks-list"></ul>

    <script>
      // Function to fetch and display tasks
      async function fetchTasks() {
        try {
          const response = await fetch("http://127.0.0.1:5000/todo/");
          const tasks = await response.json();
          const tasksList = document.getElementById("tasks-list");
          tasksList.innerHTML = ""; // Clear current list
          tasks.forEach((task) => {
            const li = document.createElement("li");
            li.textContent = `ID: ${task.taskid} - ${task.task}`;

            // Create a delete button for each task
            const deleteBtn = document.createElement("button");
            deleteBtn.textContent = "Delete";
            deleteBtn.onclick = async () => {
              await fetch(`http://127.0.0.1:5000/todo/${task.taskid}`, {
                method: "DELETE",
              });
              fetchTasks(); // Refresh list after deletion
            };

            li.appendChild(deleteBtn);
            tasksList.appendChild(li);
          });
        } catch (error) {
          console.error("Error fetching tasks:", error);
        }
      }

      // Handle the form submission to add a new task
      document
        .getElementById("task-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const userid = document.getElementById("userid").value;
          const task = document.getElementById("task").value;
          const duedate = document.getElementById("duedate").value;
          const priority = document.getElementById("priority").value;
          const category = document.getElementById("category").value;

          try {
            await fetch("http://127.0.0.1:5000/todo/", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                userid,
                task,
                duedate,
                priority,
                category,
              }),
            });
            // Reset the form and refresh the tasks list
            e.target.reset();
            fetchTasks();
          } catch (error) {
            console.error("Error adding task:", error);
          }
        });

      // Load tasks when the page loads
      fetchTasks();
    </script>
  </body>
</html>
