<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Task Manager with Reminders</title>
  <style>
    /* Basic Reset */
    body, h1, h2, h3, p, ul, li, input, button, div {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    /* Container */
    .container {
      display: flex;
      min-height: 100vh;
    }
    /* Sidebar Styling */
    .sidebar {
      width: 250px;
      background-color: #f0f0f0;
      border-right: 1px solid #ccc;
      padding: 20px;
    }
    .sidebar h2 {
      margin-bottom: 10px;
    }
    .category {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .category:hover {
      background-color: #ddd;
    }
    .category.active {
      background-color: #bbb;
      font-weight: bold;
    }
    .custom-categories {
      margin-top: 20px;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }
    .custom-categories h3 {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .custom-categories h3 span#add-category-btn {
      font-size: 24px;
      cursor: pointer;
    }
    /* Main Content Styling */
    .content {
      flex: 1;
      padding: 20px;
    }
    /* Tasks List Styling */
    #task-list li {
      display: flex;
      align-items: flex-start;
      border-bottom: 1px solid #ccc;
      padding: 8px 0;
    }
    /* The bullet icon for deletion */
    .delete-bullet {
      cursor: pointer;
      font-size: 20px;
      margin-right: 10px;
      user-select: none;
    }
    /* Task details */
    .task-details {
      display: flex;
      flex-direction: column;
    }
    .task-text {
      color: black;
      font-size: 16px;
    }
    .task-date {
      color: gray;
      font-size: 12px;
      margin-top: 2px;
    }
    /* New Task Button */
    #new-task-button {
      margin-top: 10px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }
    /* New Task Form Styling */
    #new-task-form {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin-top: 10px;
      background-color: #f9f9f9;
      display: inline-block;
    }
    #new-task-form input {
      padding: 5px;
      font-size: 14px;
      margin-right: 5px;
    }
    #new-task-form input[type="text"] {
      width: 200px;
    }
    #new-task-form input[type="date"] {
      width: 150px;
    }
    #new-task-form button {
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2>Categories</h2>
      <!-- Fixed Categories -->
      <div class="category" data-category="today">Today</div>
      <div class="category" data-category="upcoming">Upcoming</div>
      
      <!-- Custom Categories Section -->
      <div class="custom-categories">
        <h3>
          Categories
          <span id="add-category-btn">+</span>
        </h3>
        <div id="custom-category-list">
          <!-- Custom categories appended here -->
        </div>
      </div>
    </aside>
    
    <!-- Main Content Area -->
    <main class="content" id="content">
      <h1>Welcome!</h1>
      <p>Select a category from the left to see its tasks.</p>
    </main>
  </div>

  <script>
    /**************** Global Data & Helpers ****************/
    // Global array to hold all tasks. Each task: { id, category, text, dueDate }
    const allTasks = [];
    // To keep track of the current category view
    let currentCategory = "";

    // Returns today's date in "YYYY-MM-DD" format.
    function getTodayStr() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
    }

    // Filters tasks based on view.
    // "today": tasks with dueDate === today.
    // "upcoming": tasks with dueDate > today (sorted ascending).
    // Otherwise, tasks with task.category === key.
    function getFilteredTasks(key) {
      const todayStr = getTodayStr();
      if (key === "today") {
        return allTasks.filter(task => task.dueDate === todayStr);
      } else if (key === "upcoming") {
        return allTasks
          .filter(task => task.dueDate > todayStr)
          .sort((a, b) => a.dueDate.localeCompare(b.dueDate));
      } else {
        return allTasks.filter(task => task.category === key);
      }
    }

    /**************** Render & Update View ****************/
    // Renders the tasks list and, if applicable, the "New Task" button.
    function renderCategory(key, displayName) {
      const filteredTasks = getFilteredTasks(key);
      let html = `<h1>${displayName}</h1>`;
      
      // Render tasks list
      html += `<ul id="task-list">`;
      if (filteredTasks.length === 0) {
        html += `<li>No tasks yet.</li>`;
      } else {
        filteredTasks.forEach(task => {
          html += `
            <li data-id="${task.id}">
              <span class="delete-bullet">&#x2022;</span>
              <div class="task-details">
                <div class="task-text">${task.text}</div>
                <div class="task-date">${task.dueDate}</div>
              </div>
            </li>
          `;
        });
      }
      html += `</ul>`;
      
      // Only show the "New Task" button on custom category views.
      if (key !== "today" && key !== "upcoming") {
        html += `<button id="new-task-button">New Task</button>`;
      }
      
      return html;
    }

    // Update the main content area for the selected category.
    function updateContent(key, displayName) {
      currentCategory = key;
      const content = document.getElementById('content');
      content.innerHTML = renderCategory(key, displayName);
      attachTaskDeletionHandlers();
      // Only attach the New Task button handler for custom categories.
      if (key !== "today" && key !== "upcoming") {
        attachNewTaskButtonHandler(displayName);
      }
    }

    /**************** Task Deletion ****************/
    // Attach click events to bullet icons to delete tasks.
    function attachTaskDeletionHandlers() {
      const bullets = document.querySelectorAll('.delete-bullet');
      bullets.forEach(bullet => {
        bullet.addEventListener('click', function(e) {
          // Prevent the click from triggering other events.
          e.stopPropagation();
          const li = this.parentElement;
          const taskId = li.getAttribute('data-id');
          // Remove task from global array.
          const index = allTasks.findIndex(task => task.id == taskId);
          if (index !== -1) {
            allTasks.splice(index, 1);
            // Re-render current view.
            const activeCategoryElem = document.querySelector('.category.active');
            updateContent(currentCategory, activeCategoryElem ? activeCategoryElem.textContent : "");
          }
        });
      });
    }

    /**************** New Task Form ****************/
    // Attach event to the "New Task" button to show the new task form.
    function attachNewTaskButtonHandler(displayName) {
      const newTaskButton = document.getElementById('new-task-button');
      newTaskButton.addEventListener('click', () => {
        showNewTaskForm(displayName);
      });
    }

    // Displays the new task form (rounded rectangle with inputs and Add/Cancel buttons).
    function showNewTaskForm(displayName) {
      const content = document.getElementById('content');
      // Hide the "New Task" button while showing the form.
      const newTaskButton = document.getElementById('new-task-button');
      newTaskButton.style.display = 'none';
      
      // Create the form HTML.
      const formHTML = `
        <div id="new-task-form">
          <input type="text" id="new-task-text" placeholder="Reminder name">
          <input type="date" id="new-task-date" value="${getTodayStr()}">
          <button id="confirm-add-task-button">Add Task</button>
          <button id="cancel-add-task-button">Cancel</button>
        </div>
      `;
      // Insert the form right after the New Task button.
      newTaskButton.insertAdjacentHTML('afterend', formHTML);

      // Attach handlers for Add and Cancel buttons.
      document.getElementById('confirm-add-task-button').addEventListener('click', () => {
        const taskText = document.getElementById('new-task-text').value.trim();
        const taskDate = document.getElementById('new-task-date').value;
        if (!taskText) {
          alert("Please enter a reminder name.");
          return;
        }
        if (!taskDate) {
          alert("Please select a due date.");
          return;
        }
        // In custom category views, use the current category.
        const newTask = {
          id: Date.now(),
          category: currentCategory,
          text: taskText,
          dueDate: taskDate
        };
        allTasks.push(newTask);
        // Re-render the view (which removes the form).
        updateContent(currentCategory, displayName);
      });
      
      document.getElementById('cancel-add-task-button').addEventListener('click', () => {
        // Remove the new task form and show the New Task button again.
        document.getElementById('new-task-form').remove();
        newTaskButton.style.display = 'inline-block';
      });
    }

    /**************** Category Click Handling ****************/
    // Attach click behavior to sidebar category elements.
    function attachCategoryClick(elem) {
      elem.addEventListener('click', () => {
        // Remove active class from all categories.
        document.querySelectorAll('.category').forEach(cat => cat.classList.remove('active'));
        elem.classList.add('active');
        const key = elem.getAttribute('data-category');
        const displayName = elem.textContent;
        updateContent(key, displayName);
      });
    }
    // Attach to fixed categories ("Today" and "Upcoming").
    document.querySelectorAll('.category').forEach(attachCategoryClick);

    /**************** Custom Categories ****************/
    const addCategoryBtn = document.getElementById('add-category-btn');
    const customCategoryList = document.getElementById('custom-category-list');
    addCategoryBtn.addEventListener('click', () => {
      const newCategoryName = prompt("Enter new category name:");
      if (newCategoryName) {
        const key = newCategoryName.trim().toLowerCase().replace(/\s+/g, '-');
        if (document.querySelector(`[data-category="${key}"]`)) {
          alert("Category already exists!");
          return;
        }
        const newCatElem = document.createElement('div');
        newCatElem.className = 'category';
        newCatElem.setAttribute('data-category', key);
        newCatElem.textContent = newCategoryName;
        attachCategoryClick(newCatElem);
        customCategoryList.appendChild(newCatElem);
      }
    });
  </script>
</body>
</html>
